        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>FrictionJoint Class / box2d Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="box2d" data-type="FrictionJoint">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../box2d.html">box2d</a> &rsaquo; <a href="../box2d/FrictionJoint.html">FrictionJoint</a></div>
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>FrictionJoint</strong>
          Class
        </h2>
        
<div class="doc">

</div>
<h3>Extends</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../box2d/Joint.html">Joint</a></span>&nbsp;&gt;&nbsp;<span class="type-box"><span class="icon-class"></span><strong>FrictionJoint</strong></span></p>
<h3>Constructors</h3>
<div class="method"><h4 id="FrictionJoint">
<span class="show-code">Code</span>
new <strong>FrictionJoint</strong>(<a href="../box2d/FrictionJointDef.html">FrictionJointDef</a> def) <a class="anchor-link" href="#FrictionJoint"
              title="Permalink to FrictionJoint.FrictionJoint">#</a></h4>
<div class="doc">

<pre class="source">
FrictionJoint(FrictionJointDef def)
    : super(def),
      _localAnchorA = new Vector.copy(def.localAnchorA),
      _localAnchorB = new Vector.copy(def.localAnchorB),
      _linearImpulse = new Vector(),
      _angularImpulse = 0.0,
      _maxForce = def.maxForce,
      _maxTorque = def.maxTorque { }
</pre>
</div>
</div>
<h3>Methods</h3>
<div class="method"><h4 id="getLocalAnchorA">
<span class="show-code">Code</span>
<a href="../box2d/Vector.html">Vector</a> <strong>getLocalAnchorA</strong>(<a href="../box2d/Vector.html">Vector</a> argOut) <a class="anchor-link" href="#getLocalAnchorA"
              title="Permalink to FrictionJoint.getLocalAnchorA">#</a></h4>
<div class="doc">

<pre class="source">
Vector getLocalAnchorA(Vector argOut) {
  bodyA.getWorldPointToOut(_localAnchorA, argOut);
}
</pre>
</div>
</div>
<div class="method"><h4 id="getLocalAnchorB">
<span class="show-code">Code</span>
<a href="../box2d/Vector.html">Vector</a> <strong>getLocalAnchorB</strong>(<a href="../box2d/Vector.html">Vector</a> argOut) <a class="anchor-link" href="#getLocalAnchorB"
              title="Permalink to FrictionJoint.getLocalAnchorB">#</a></h4>
<div class="doc">

<pre class="source">
Vector getLocalAnchorB(Vector argOut) {
  bodyB.getWorldPointToOut(_localAnchorB, argOut);
}
</pre>
</div>
</div>
<div class="method"><h4 id="getReactionForce">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>getReactionForce</strong>(<a href="../dart_core/num.html">num</a> inv_dt, <a href="../box2d/Vector.html">Vector</a> argOut) <a class="anchor-link" href="#getReactionForce"
              title="Permalink to FrictionJoint.getReactionForce">#</a></h4>
<div class="doc">

<pre class="source">
void getReactionForce(num inv_dt, Vector argOut) {
  argOut.setFrom(_linearImpulse).mulLocal(inv_dt);
}
</pre>
</div>
</div>
<div class="method"><h4 id="getReactionTorque">
<span class="show-code">Code</span>
<a href="../dart_core/num.html">num</a> <strong>getReactionTorque</strong>(<a href="../dart_core/num.html">num</a> inv_dt) <a class="anchor-link" href="#getReactionTorque"
              title="Permalink to FrictionJoint.getReactionTorque">#</a></h4>
<div class="doc">

<pre class="source">
num getReactionTorque(num inv_dt) =&gt; inv_dt * _angularImpulse;
</pre>
</div>
</div>
<div class="method"><h4 id="initVelocityConstraints">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>initVelocityConstraints</strong>(<a href="../box2d/TimeStep.html">TimeStep</a> step) <a class="anchor-link" href="#initVelocityConstraints"
              title="Permalink to FrictionJoint.initVelocityConstraints">#</a></h4>
<div class="doc">

<pre class="source">
void initVelocityConstraints(TimeStep step) {
  // Compute the effective mass matrix.
  Vector r1 = new Vector();
  Vector r2 = new Vector();

  r1.setFrom(_localAnchorA).subLocal(bodyA.localCenter);
  r2.setFrom(_localAnchorB).subLocal(bodyB.localCenter);
  Matrix22.mulMatrixAndVectorToOut(bodyA.originTransform.rotation, r1, r1);
  Matrix22.mulMatrixAndVectorToOut(bodyB.originTransform.rotation, r2, r2);

  // J = [-I -r1_skew I r2_skew]
  // [ 0 -1 0 1]
  // r_skew = [-ry; rx]

  // Matlab
  // K = [ mA+r1y^2*iA+mB+r2y^2*iB, -r1y*iA*r1x-r2y*iB*r2x, -r1y*iA-r2y*iB]
  // [ -r1y*iA*r1x-r2y*iB*r2x, mA+r1x^2*iA+mB+r2x^2*iB, r1x*iA+r2x*iB]
  // [ -r1y*iA-r2y*iB, r1x*iA+r2x*iB, iA+iB]

  Matrix22 K = new Matrix22();
  K.col1.x = bodyA.invMass + bodyB.invMass +
             bodyA.invInertia * r1.y * r1.y + bodyB.invInertia * r2.y * r2.y;
  K.col1.y = -bodyA.invInertia * r1.x * r1.y - bodyB.invInertia * r2.x * r2.y;
  K.col2.x = K.col1.y;
  K.col2.y = bodyA.invMass + bodyB.invMass +
             bodyA.invInertia * r1.x * r1.x + bodyB.invInertia * r2.x * r2.x;

  Matrix22 linearMass = new Matrix22();
  linearMass.setFrom(K);
  linearMass.invertLocal();

  num angularMass = bodyA.invInertia + bodyB.invInertia;
  if (angularMass &gt; 0.0) {
    angularMass = 1.0 / angularMass;
  }

  if (step.warmStarting) {
    // Scale impulses.
    _linearImpulse.mulLocal(step.dtRatio);
    _angularImpulse *= step.dtRatio;

    Vector P = new Vector();
    P.setFrom(_linearImpulse);

    bodyA.linearVelocity.x -= bodyA.invMass * P.x;
    bodyA.linearVelocity.y -= bodyA.invMass * P.y;
    bodyA.angularVelocity -= bodyA.invInertia * (Vector.crossVectors(r1, P) + _angularImpulse);

    bodyB.linearVelocity.x += bodyB.invMass * P.x;
    bodyB.linearVelocity.y += bodyB.invMass * P.y;
    bodyB.angularVelocity += bodyB.invInertia * (Vector.crossVectors(r2, P) + _angularImpulse);
  } else {
    _linearImpulse.setZero();
    _angularImpulse = 0.0;
  }
}
</pre>
</div>
</div>
<div class="method"><h4 id="get:maxForce">
<span class="show-code">Code</span>
<a href="../dart_core/num.html">num</a> <strong>get maxForce</strong>() <a class="anchor-link" href="#get:maxForce"
              title="Permalink to FrictionJoint.get maxForce">#</a></h4>
<div class="doc">

<pre class="source">
num get maxForce() =&gt; _maxForce;
</pre>
</div>
</div>
<div class="method"><h4 id="set:maxForce">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>set maxForce</strong>(<a href="../dart_core/num.html">num</a> force) <a class="anchor-link" href="#set:maxForce"
              title="Permalink to FrictionJoint.set maxForce">#</a></h4>
<div class="doc">

<pre class="source">
void set maxForce(num force) {
  assert(force &gt;= 0.0);
  _maxForce = force;
}
</pre>
</div>
</div>
<div class="method"><h4 id="get:maxTorque">
<span class="show-code">Code</span>
<a href="../dart_core/num.html">num</a> <strong>get maxTorque</strong>() <a class="anchor-link" href="#get:maxTorque"
              title="Permalink to FrictionJoint.get maxTorque">#</a></h4>
<div class="doc">

<pre class="source">
num get maxTorque() =&gt; _maxTorque;
</pre>
</div>
</div>
<div class="method"><h4 id="set:maxTorque">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>set maxTorque</strong>(<a href="../dart_core/num.html">num</a> torque) <a class="anchor-link" href="#set:maxTorque"
              title="Permalink to FrictionJoint.set maxTorque">#</a></h4>
<div class="doc">

<pre class="source">
void set maxTorque(num torque) {
  assert(torque &gt;= 0.0);
  _maxTorque = torque;
}
</pre>
</div>
</div>
<div class="method"><h4 id="solvePositionConstraints">
<span class="show-code">Code</span>
<a href="../dart_core/bool.html">bool</a> <strong>solvePositionConstraints</strong>(<a href="../dart_core/num.html">num</a> baumgarte) <a class="anchor-link" href="#solvePositionConstraints"
              title="Permalink to FrictionJoint.solvePositionConstraints">#</a></h4>
<div class="doc">

<pre class="source">
bool solvePositionConstraints(num baumgarte) =&gt; true;
</pre>
</div>
</div>
<div class="method"><h4 id="solveVelocityConstraints">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>solveVelocityConstraints</strong>(<a href="../box2d/TimeStep.html">TimeStep</a> step) <a class="anchor-link" href="#solveVelocityConstraints"
              title="Permalink to FrictionJoint.solveVelocityConstraints">#</a></h4>
<div class="doc">

<pre class="source">
void solveVelocityConstraints(TimeStep step) {
  // Solve angular friction
  {
    final num Cdot = bodyB.angularVelocity - bodyA.angularVelocity;
    num angularMass = bodyA.invInertia + bodyB.invInertia;
    if (angularMass &gt; 0.0) {
      angularMass = 1.0 / angularMass;
    }
    num impulse = -angularMass * Cdot;

    final num oldImpulse = _angularImpulse;
    final num maxImpulse = step.dt * _maxTorque;
    _angularImpulse = MathBox.clamp(_angularImpulse + impulse, -maxImpulse, maxImpulse);
    impulse = _angularImpulse - oldImpulse;

    bodyA.angularVelocity -= bodyA.invInertia * impulse;
    bodyB.angularVelocity += bodyB.invInertia * impulse;
  }

  // Solve linear friction
  {
    Vector r1 = new Vector();
    Vector r2 = new Vector();

    r1.setFrom(_localAnchorA).subLocal(bodyA.localCenter);
    r2.setFrom(_localAnchorB).subLocal(bodyB.localCenter);
    Matrix22.mulMatrixAndVectorToOut(bodyA.originTransform.rotation, r1, r1);
    Matrix22.mulMatrixAndVectorToOut(bodyB.originTransform.rotation, r2, r2);

    Vector temp = new Vector();
    Vector Cdot = new Vector();

    Vector.crossNumAndVectorToOut(bodyA.angularVelocity, r1, temp);
    Vector.crossNumAndVectorToOut(bodyB.angularVelocity, r2, Cdot);

    Cdot.addLocal(bodyB.linearVelocity).subLocal(bodyA.linearVelocity).subLocal(temp);

    Matrix22 K = new Matrix22();
    K.col1.x = bodyA.invMass + bodyB.invMass +
               bodyA.invInertia * r1.y * r1.y + bodyB.invInertia * r2.y * r2.y;
    K.col1.y = -bodyA.invInertia * r1.x * r1.y - bodyB.invInertia * r2.x * r2.y;
    K.col2.x = K.col1.y;
    K.col2.y = bodyA.invMass + bodyB.invMass +
               bodyA.invInertia * r1.x * r1.x + bodyB.invInertia * r2.x * r2.x;

    Matrix22 linearMass = new Matrix22();
    linearMass.setFrom(K);
    linearMass.invertLocal();

    Vector impulse = new Vector();
    Matrix22.mulMatrixAndVectorToOut(linearMass, Cdot, impulse);
    impulse.negateLocal();

    Vector oldImpulse = new Vector();
    oldImpulse.setFrom(_linearImpulse);
    _linearImpulse.addLocal(impulse);

    num maxImpulse = step.dt * _maxForce;
    if (_linearImpulse.lengthSquared &gt; maxImpulse * maxImpulse) {
      _linearImpulse.normalize();
      _linearImpulse.mulLocal(maxImpulse);
    }

    impulse.setFrom(_linearImpulse).subLocal(oldImpulse);

    bodyA.linearVelocity.x -= impulse.x * bodyA.invMass;
    bodyA.linearVelocity.y -= impulse.y * bodyA.invMass;
    bodyA.angularVelocity -= bodyA.invInertia * Vector.crossVectors(r1, impulse);

    bodyB.linearVelocity.x += impulse.x * bodyB.invMass;
    bodyB.linearVelocity.y += impulse.y * bodyB.invMass;
    bodyB.angularVelocity += bodyB.invInertia * Vector.crossVectors(r2, impulse);
  }
}
</pre>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        
        <div class="footer">
          <div>This page generated at 2012-07-26 10:55:37.204</div>
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
