        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>ConstantVolumeJoint Class / box2d Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="box2d" data-type="ConstantVolumeJoint">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../box2d.html">box2d</a> &rsaquo; <a href="../box2d/ConstantVolumeJoint.html">ConstantVolumeJoint</a></div>
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>ConstantVolumeJoint</strong>
          Class
        </h2>
        
<div class="doc">
<p>This joint is commonly used to simulate a soft body with a constant volume.
A constant volume joint can only be created with three or more bodies. The
area within a grouping of constant volume joints is kept constant, such that
the compression of one part of the area will be offset by the expansion of
other parts.</p>
</div>
<h3>Extends</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../box2d/Joint.html">Joint</a></span>&nbsp;&gt;&nbsp;<span class="type-box"><span class="icon-class"></span><strong>ConstantVolumeJoint</strong></span></p>
<h3>Constructors</h3>
<div class="method"><h4 id="ConstantVolumeJoint">
<span class="show-code">Code</span>
new <strong>ConstantVolumeJoint</strong>(_world, <a href="../box2d/ConstantVolumeJointDef.html">ConstantVolumeJointDef</a> def) <a class="anchor-link" href="#ConstantVolumeJoint"
              title="Permalink to ConstantVolumeJoint.ConstantVolumeJoint">#</a></h4>
<div class="doc">

<pre class="source">
ConstantVolumeJoint(this._world, ConstantVolumeJointDef def) :
  super(def),
  _impulse = 0 {
  if (def.bodies.length &lt;= 2) {
    throw new IllegalArgumentException(
        "You cannot create a constant volume joint with less than three "
        "bodies.");
  }

  // Create a fixed size array with a capacity equal to the number of elements
  // in the growable array in the definition.
  bodies = new List.from(def.bodies);

  targetLengths = new List&lt;num&gt;(bodies.length);
  for (int i = 0; i &lt; targetLengths.length; ++i) {
    final int next = (i == targetLengths.length - 1) ? 0 : i + 1;
    Vector temp = new Vector.copy(bodies[i].worldCenter);
    temp.subLocal(bodies[next].worldCenter);
    num dist = temp.length;
    targetLengths[i] = dist;
  }
  targetVolume = area;

  if (def.joints != null &amp;&amp; def.joints.length != def.bodies.length) {
    throw new IllegalArgumentException(
        "Incorrect joint definition.  Joints have to correspond to "
        "the bodies");
  }

  if (def.joints == null) {
    final djd = new DistanceJointDef();
    distanceJoints = new List&lt;DistanceJoint&gt;(bodies.length);
    for (int i = 0; i &lt; targetLengths.length; ++i) {
      final int next = (i == targetLengths.length - 1) ? 0 : i + 1;
      djd.frequencyHz = def.frequencyHz;
      djd.dampingRatio = def.dampingRatio;
      djd.initialize(bodies[i], bodies[next], bodies[i].worldCenter,
          bodies[next].worldCenter);
      distanceJoints[i] = _world.createJoint(djd);
    }
  } else {
    distanceJoints = new List&lt;DistanceJoint&gt;(def.joints.length);
    distanceJoints.setRange(0, def.joints.length, def.joints);
  }

  frequencyHz = def.frequencyHz;
  dampingRatio = def.dampingRatio;

  normals = new List&lt;Vector&gt;(bodies.length);
  for (int i = 0; i &lt; normals.length; ++i) {
    normals[i] = new Vector();
  }

  this.bodyA = bodies[0];
  this.bodyB = bodies[1];
  this.collideConnected = false;
}
</pre>
</div>
</div>
<h3>Methods</h3>
<div class="method"><h4 id="get:area">
<span class="show-code">Code</span>
<a href="../dart_core/num.html">num</a> <strong>get area</strong>() <a class="anchor-link" href="#get:area"
              title="Permalink to ConstantVolumeJoint.get area">#</a></h4>
<div class="doc">

<pre class="source">
num get area() {
  num result = 0.0;
  result += bodies[bodies.length - 1].worldCenter.x * bodies[0].worldCenter.y
      - bodies[0].worldCenter.x * bodies[bodies.length - 1].worldCenter.y;
  for (int i = 0; i &lt; bodies.length - 1; ++i) {
    result += bodies[i].worldCenter.x * bodies[i + 1].worldCenter.y
        - bodies[i + 1].worldCenter.x * bodies[i].worldCenter.y;
  }
  result *= .5;
  return result;
}
</pre>
</div>
</div>
<div class="method"><h4 id="constrainEdges">
<span class="show-code">Code</span>
<a href="../dart_core/bool.html">bool</a> <strong>constrainEdges</strong>(<a href="../box2d/TimeStep.html">TimeStep</a> argStep) <a class="anchor-link" href="#constrainEdges"
              title="Permalink to ConstantVolumeJoint.constrainEdges">#</a></h4>
<div class="doc">
<p>Apply the position correction to the particles.</p>
<pre class="source">
bool constrainEdges(TimeStep argStep) {
  num perimeter = 0.0;
  for (int i = 0; i &lt; bodies.length; ++i) {
    final int next = (i == bodies.length - 1) ? 0 : i + 1;
    num dx = bodies[next].worldCenter.x - bodies[i].worldCenter.x;
    num dy = bodies[next].worldCenter.y - bodies[i].worldCenter.y;
    num dist = Math.sqrt(dx * dx + dy * dy);
    if (dist &lt; Settings.EPSILON) {
      dist = 1.0;
    }
    normals[i].x = dy / dist;
    normals[i].y = -dx / dist;
    perimeter += dist;
  }

  final delta = new Vector();

  num deltaArea = targetVolume - area;
  num toExtrude = 0.5 * deltaArea / perimeter; // relaxationFactor
  bool done = true;
  for (int i = 0; i &lt; bodies.length; ++i) {
    final int next = (i == bodies.length - 1) ? 0 : i + 1;
    delta.setCoords(toExtrude * (normals[i].x + normals[next].x), toExtrude
        * (normals[i].y + normals[next].y));
    num norm = delta.length;
    if (norm &gt; Settings.MAX_LINEAR_CORRECTION) {
      delta.mulLocal(Settings.MAX_LINEAR_CORRECTION / norm);
    }
    if (norm &gt; Settings.LINEAR_SLOP) {
      done = false;
    }
    bodies[next].sweep.center.x += delta.x;
    bodies[next].sweep.center.y += delta.y;
    bodies[next].synchronizeTransform();
  }

  return done;
}
</pre>
</div>
</div>
<div class="method"><h4 id="destructor">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>destructor</strong>() <a class="anchor-link" href="#destructor"
              title="Permalink to ConstantVolumeJoint.destructor">#</a></h4>
<div class="doc">

<pre class="source">
void destructor() {
  for (int i = 0; i &lt; distanceJoints.length; ++i) {
    _world.destroyJoint(distanceJoints[i]);
  }
}
</pre>
</div>
</div>
<div class="method"><h4 id="getAnchorA">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>getAnchorA</strong>(<a href="../box2d/Vector.html">Vector</a> argOut) <a class="anchor-link" href="#getAnchorA"
              title="Permalink to ConstantVolumeJoint.getAnchorA">#</a></h4>
<div class="doc">

<pre class="source">
void getAnchorA(Vector argOut) {
  throw new NotImplementedException();
}
</pre>
</div>
</div>
<div class="method"><h4 id="getAnchorB">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>getAnchorB</strong>(<a href="../box2d/Vector.html">Vector</a> argOut) <a class="anchor-link" href="#getAnchorB"
              title="Permalink to ConstantVolumeJoint.getAnchorB">#</a></h4>
<div class="doc">

<pre class="source">
void getAnchorB(Vector argOut) {
  throw new NotImplementedException();
}
</pre>
</div>
</div>
<div class="method"><h4 id="getReactionForce">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>getReactionForce</strong>(<a href="../dart_core/num.html">num</a> inv_dt, <a href="../box2d/Vector.html">Vector</a> argOut) <a class="anchor-link" href="#getReactionForce"
              title="Permalink to ConstantVolumeJoint.getReactionForce">#</a></h4>
<div class="doc">

<pre class="source">
void getReactionForce(num inv_dt, Vector argOut) {
  throw new NotImplementedException();
}
</pre>
</div>
</div>
<div class="method"><h4 id="getReactionTorque">
<span class="show-code">Code</span>
<a href="../dart_core/num.html">num</a> <strong>getReactionTorque</strong>(<a href="../dart_core/num.html">num</a> inv_dt) <a class="anchor-link" href="#getReactionTorque"
              title="Permalink to ConstantVolumeJoint.getReactionTorque">#</a></h4>
<div class="doc">

<pre class="source">
num getReactionTorque(num inv_dt) {
  throw new NotImplementedException();
}
</pre>
</div>
</div>
<div class="method"><h4 id="inflate">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>inflate</strong>(<a href="../dart_core/num.html">num</a> factor) <a class="anchor-link" href="#inflate"
              title="Permalink to ConstantVolumeJoint.inflate">#</a></h4>
<div class="doc">

<pre class="source">
void inflate(num factor) {
  targetVolume *= factor;
}
</pre>
</div>
</div>
<div class="method"><h4 id="initVelocityConstraints">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>initVelocityConstraints</strong>(<a href="../box2d/TimeStep.html">TimeStep</a> argStep) <a class="anchor-link" href="#initVelocityConstraints"
              title="Permalink to ConstantVolumeJoint.initVelocityConstraints">#</a></h4>
<div class="doc">

<pre class="source">
void initVelocityConstraints(TimeStep argStep) {
  step = argStep;

  final d = new List&lt;Vector&gt;(bodies.length);
  for (int i = 0; i &lt; bodies.length; i++) {
    d[i] = new Vector();
  }

  for (int i = 0; i &lt; bodies.length; ++i) {
    final int prev = (i == 0) ? bodies.length - 1 : i - 1;
    final int next = (i == bodies.length - 1) ? 0 : i + 1;
    d[i].setFrom(bodies[next].worldCenter);
    d[i].subLocal(bodies[prev].worldCenter);
  }

  if (step.warmStarting) {
    _impulse *= step.dtRatio;
    for (int i = 0; i &lt; bodies.length; ++i) {
      bodies[i].linearVelocity.x += bodies[i].invMass * d[i].y *
          .5 * _impulse;
      bodies[i].linearVelocity.y += bodies[i].invMass * -d[i].x *
          .5 * _impulse;
    }
  } else {
    _impulse = 0.0;
  }
}
</pre>
</div>
</div>
<div class="method"><h4 id="solvePositionConstraints">
<span class="show-code">Code</span>
<a href="../dart_core/bool.html">bool</a> <strong>solvePositionConstraints</strong>(<a href="../dart_core/num.html">num</a> baumgarte) <a class="anchor-link" href="#solvePositionConstraints"
              title="Permalink to ConstantVolumeJoint.solvePositionConstraints">#</a></h4>
<div class="doc">
<p>Solves for the impact of this joint on the positions of the connected
bodies. Implements abstract method in <a class="crossref" href="../box2d/Joint.html">Joint</a>.</p>
<pre class="source">
bool solvePositionConstraints(num baumgarte) {
  return constrainEdges(step);
}
</pre>
</div>
</div>
<div class="method"><h4 id="solveVelocityConstraints">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>solveVelocityConstraints</strong>(<a href="../box2d/TimeStep.html">TimeStep</a> argStep) <a class="anchor-link" href="#solveVelocityConstraints"
              title="Permalink to ConstantVolumeJoint.solveVelocityConstraints">#</a></h4>
<div class="doc">
<p>Solves for the impact of this joint on the velocities of the connected
bodies. Implements abstract method in <a class="crossref" href="../box2d/Joint.html">Joint</a>.</p>
<pre class="source">
void solveVelocityConstraints(TimeStep argStep) {
  num crossMassSum = 0.0;
  num dotMassSum = 0.0;

  final d = new List&lt;Vector&gt;(bodies.length);
  for (int i = 0; i &lt; bodies.length; i++) {
    d[i] = new Vector();
  }

  for (int i = 0; i &lt; bodies.length; ++i) {
    final int prev = (i == 0) ? bodies.length - 1 : i - 1;
    final int next = (i == bodies.length - 1) ? 0 : i + 1;
    d[i].setFrom(bodies[next].worldCenter);
    d[i].subLocal(bodies[prev].worldCenter);
    dotMassSum += (d[i].lengthSquared) / bodies[i].mass;
    crossMassSum += Vector.crossVectors(bodies[i].linearVelocity, d[i]);
  }
  num lambda = -2.0 * crossMassSum / dotMassSum;
  _impulse += lambda;
  for (int i = 0; i &lt; bodies.length; ++i) {
    bodies[i].linearVelocity.x += bodies[i].invMass * d[i].y * .5 * lambda;
    bodies[i].linearVelocity.y += bodies[i].invMass * -d[i].x * .5 * lambda;
  }
}
</pre>
</div>
</div>
<h3>Fields</h3>
<div class="field"><h4 id="bodies">
<span class="show-code">Code</span>
<a href="../dart_core/List.html">List</a>         <strong>bodies</strong> <a class="anchor-link"
            href="#bodies"
            title="Permalink to ConstantVolumeJoint.bodies">#</a>
        </h4>
        <div class="doc">

<pre class="source">
List&lt;Body&gt; bodies;
</pre>
</div>
</div>
<div class="field"><h4 id="dampingRatio">
<span class="show-code">Code</span>
<a href="../dart_core/num.html">num</a>         <strong>dampingRatio</strong> <a class="anchor-link"
            href="#dampingRatio"
            title="Permalink to ConstantVolumeJoint.dampingRatio">#</a>
        </h4>
        <div class="doc">

<pre class="source">
num dampingRatio;
</pre>
</div>
</div>
<div class="field"><h4 id="distanceJoints">
<span class="show-code">Code</span>
<a href="../dart_core/List.html">List</a>         <strong>distanceJoints</strong> <a class="anchor-link"
            href="#distanceJoints"
            title="Permalink to ConstantVolumeJoint.distanceJoints">#</a>
        </h4>
        <div class="doc">

<pre class="source">
List&lt;DistanceJoint&gt; distanceJoints;
</pre>
</div>
</div>
<div class="field"><h4 id="frequencyHz">
<span class="show-code">Code</span>
<a href="../dart_core/num.html">num</a>         <strong>frequencyHz</strong> <a class="anchor-link"
            href="#frequencyHz"
            title="Permalink to ConstantVolumeJoint.frequencyHz">#</a>
        </h4>
        <div class="doc">

<pre class="source">
num frequencyHz;
</pre>
</div>
</div>
<div class="field"><h4 id="normals">
<span class="show-code">Code</span>
<a href="../dart_core/List.html">List</a>         <strong>normals</strong> <a class="anchor-link"
            href="#normals"
            title="Permalink to ConstantVolumeJoint.normals">#</a>
        </h4>
        <div class="doc">

<pre class="source">
List&lt;Vector&gt; normals;
</pre>
</div>
</div>
<div class="field"><h4 id="step">
<span class="show-code">Code</span>
<a href="../box2d/TimeStep.html">TimeStep</a>         <strong>step</strong> <a class="anchor-link"
            href="#step"
            title="Permalink to ConstantVolumeJoint.step">#</a>
        </h4>
        <div class="doc">

<pre class="source">
TimeStep step;
</pre>
</div>
</div>
<div class="field"><h4 id="targetLengths">
<span class="show-code">Code</span>
<a href="../dart_core/List.html">List</a>         <strong>targetLengths</strong> <a class="anchor-link"
            href="#targetLengths"
            title="Permalink to ConstantVolumeJoint.targetLengths">#</a>
        </h4>
        <div class="doc">

<pre class="source">
List&lt;num&gt; targetLengths;
</pre>
</div>
</div>
<div class="field"><h4 id="targetVolume">
<span class="show-code">Code</span>
<a href="../dart_core/num.html">num</a>         <strong>targetVolume</strong> <a class="anchor-link"
            href="#targetVolume"
            title="Permalink to ConstantVolumeJoint.targetVolume">#</a>
        </h4>
        <div class="doc">

<pre class="source">
num targetVolume;
</pre>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        
        <div class="footer">
          <div>This page generated at 2012-07-27 11:18:51.846</div>
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
